The script `GCAM_to_IAMC_Aggregation.R` aggregates emission scenarios generated by the [GCAM](https://github.com/JGCRI/gcam-core) model to the modified IAMC format for producing [future gridded emissions](https://github.com/iiasa/emissions_downscaling) in the format used by climate models as part of [CMIP6](https://www.wcrp-climate.org/wgcm-cmip/wgcm-cmip6).


**Sector Mapping**


Most GCAM sectors are mapped directly to an IAMC output sector, with a few exceptions:


* Agriculture (AGR) and Agricultural Waste Burning (AWB) emissions: These emissions are mapped to an output sector based on a suffix that is added to their GHG by default. For example, an entry with a GHG of “N2O_AWB” would be mapped to the Agricultural Waste Burning output sector.
* Some GCAM subsectors are mapped to a separate output sector. For example, GCAM sector “industrial processes” has multiple subsectors. Most of these subsectors are mapped to the Industrial Sector output sector, except for GCAM subsector “solvents”, which is mapped to the Solvents Production and Application output sector. 
* Other exceptions include GCAM sector “trn_pass” and “UnmanagedLand”.

  These are handled case by case in the script.



International Shipping and aviation are aggregated globally because they are mapped to a spatial grid on a global basis. The “Regional” column in `GCAM_IAMC_mapping.csv` indicates whether or not the emissions should be aggregated regionally (1) or globally (0).



**Inputs**


`GCAM_nonCO2_emissions.csv`:

The GCAM nonCO2 emissions input should be the result of a query from the relevant GCAM database for emissions by subsector. The file can contain multiple scenarios. A truncated example is included (`GCAM_nonCO2_emissions_example.csv`) with proper column names.



`GCAM_IAMC_mapping.csv`:

This file maps GCAM sectors and subsectors to IAMC output sectors, and indicates whether the output sector emissions should be aggregated regionally or globally. If new sectors are added to GCAM this file may need to be modified.





**Script Outputs**


Data is written to the `output` folder:

•	`GCAM_output.xlsx` contains the aggregated emissions, and is used as an input for downscaling.

•	`diagnostic.csv` contains total input and output emissions for each scenario, year, and GHG, as well as the difference in emissions (should be 0, or very close to). “value_original” indicates emissions in the input data (`GCAM_nonCO2_emissions.csv`) and “value” indicates emissions in the output data (`GCAM_output.xlsx`). If there are differences here that are not tiny, this probably indicates a missing sector in the mapping file.



**Using This script**


To use this script, the user must create the `GCAM_nonCO2_emissions.csv` input and place it in the `input` folder. This should be the result of a query. The user must also set the working directory to their `input` folder.

